<!DOCTYPE html><html lang="zh-cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>make hello! 全局 Makefile 模式匹配 | Jenway's Blog</title><meta name="author" content="Jenway"><meta name="copyright" content="Jenway"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这个博客将会介绍如何编写全局的 makefile 模式匹配，用来替换默认的隐式规则。 最终你可以直接使用 make hello 来编译 hello.c 文件、hello.tex 文件等等，而不用再写更长的编译命令。 同时，你还可以自定义这里的编译器，编译选项等等，甚至增加新的模式匹配。 内置隐式规则 (Built-in Implicit rules ) 实际上，你很可能已经使用过内置的隐式规则了">
<meta property="og:type" content="article">
<meta property="og:title" content="make hello! 全局 Makefile 模式匹配">
<meta property="og:url" content="https://blog.jenway.link/posts/4a5195d4.html">
<meta property="og:site_name" content="Jenway&#39;s Blog">
<meta property="og:description" content="这个博客将会介绍如何编写全局的 makefile 模式匹配，用来替换默认的隐式规则。 最终你可以直接使用 make hello 来编译 hello.c 文件、hello.tex 文件等等，而不用再写更长的编译命令。 同时，你还可以自定义这里的编译器，编译选项等等，甚至增加新的模式匹配。 内置隐式规则 (Built-in Implicit rules ) 实际上，你很可能已经使用过内置的隐式规则了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover41.webp">
<meta property="article:published_time" content="2023-09-25T15:49:19.000Z">
<meta property="article:modified_time" content="2024-12-25T17:01:50.802Z">
<meta property="article:author" content="Jenway">
<meta property="article:tag" content="make">
<meta property="article:tag" content="makefile">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover41.webp"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://blog.jenway.link/posts/4a5195d4.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'make hello! 全局 Makefile 模式匹配',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><!-- hexo injector head_end start --><link rel="stylesheet" href="/css/footerTransp.css?1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"/><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(img/bak.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">54</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">49</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">11</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/bangumi/"><i class="fa-fw fas fa-bilibili"></i><span> Bangumi</span></a></li><li><a class="site-page child" href="/custom/homepage/index.html"><i class="fa-fw fas fa-graduation-cap"></i><span> CS50</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover41.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Jenway's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">make hello! 全局 Makefile 模式匹配</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/bangumi/"><i class="fa-fw fas fa-bilibili"></i><span> Bangumi</span></a></li><li><a class="site-page child" href="/custom/homepage/index.html"><i class="fa-fw fas fa-graduation-cap"></i><span> CS50</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">make hello! 全局 Makefile 模式匹配</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-09-25T15:49:19.000Z" title="Created 2023-09-25 23:49:19">2023-09-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-12-25T17:01:50.802Z" title="Updated 2024-12-26 01:01:50">2024-12-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/">开发记录</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/4a5195d4.html#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><!-- <meting-js
    server="netease"
    type="song"
    autoplay="true"
    id="18126594">
</meting-js> -->
<p>这个博客将会介绍如何编写全局的 makefile 模式匹配，用来替换默认的隐式规则。</p>
<p>最终你可以直接使用 <code>make hello</code> 来编译 <code>hello.c</code> 文件、<code>hello.tex</code> 文件等等，而不用再写更长的编译命令。</p>
<p>同时，你还可以自定义这里的编译器，编译选项等等，甚至增加新的模式匹配。</p>
<h2 id="内置隐式规则-Built-in-Implicit-rules">内置隐式规则 (Built-in Implicit rules )</h2>
<p>实际上，你很可能已经使用过内置的隐式规则了，假如当前目录下有一个 <code>hello.c</code> 文件，那么你可以直接使用 <code>make hello</code> 来编译它，这就是一个隐式规则。</p>
<p>隐式规则可以自动推导出目标文件的依赖关系，比如 <code>hello.o</code> 依赖于 <code>hello.c</code>，并且可以自动推导出命令，比如 <code>gcc -c hello.c -o hello.o</code>。如果是 <code>.cpp</code> 文件，那么命令就是 <code>g++ -c hello.cpp -o hello.o</code>。</p>
<blockquote>
<p>某些标准的方式经常用于重新制作目标文件。例如，一种常见的制作目标文件的方式是使用 C 编译器从 C 源文件制作目标文件。</p>
<p>隐式规则告诉 make 如何使用惯用的技术，这样当你想使用它们时，你就不必详细地指定它们。例如，有一个隐式规则用于 C 编译。文件名决定了要运行哪些隐式规则。例如，C 编译通常需要一个 .c 文件并生成一个 .o 文件。因此，当它看到这种文件名组合时，make 就会应用 C 编译的隐式规则。</p>
<p>内置的隐式规则在它们的配方中使用了几个变量，这样，通过改变变量的值，你可以改变隐式规则的工作方式。例如，变量 CFLAGS 控制着 C 编译的隐式规则给 C 编译器的标志。<br>
你可以通过编写模式规则来定义自己的隐式规则。后缀规则是一种更有限的定义隐式规则的方法。模式规则更通用、更清晰，但是后缀规则是为了兼容性而保留的。<br>
– 参见 <a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Implicit-Rules.html">GNU make manual – Implicit-Rules</a></p>
</blockquote>
<h3 id="模式规则-Pattern-Rules">模式规则 ( Pattern Rules )</h3>
<p>模式匹配 (Pattern Match) 是 makefile 中的一种特殊规则，它可以匹配所有的目标文件。</p>
<blockquote>
<p>你可以通过编写模式规则来定义自己的隐式规则。一个模式规则看起来像一个普通的规则，除了它的目标包含了一个 <code>%</code> 字符 ( 只有一个 )。目标被认为是匹配文件名的模式；<code>%</code> 可以匹配任何非空的子字符串，而其他字符只能匹配它们自己。前提条件同样使用 <code>%</code> 来显示它们的名称与目标名称的关系。</p>
<p>因此，模式规则 <code>%.o : %.c</code> 表示如何从另一个文件 <code>stem.c</code> 制作任何文件 <code>stem.o</code>。</p>
<p>请注意，在模式规则中使用 <code>%</code> 进行扩展时，会在任何变量或函数扩展之后进行，这些变量或函数扩展是在读取 makefile 时进行的。</p>
</blockquote>
<p>参见 <a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html">GNU make manual – Pattern-Rules</a></p>
<h2 id="我为什么需要手动编写模式匹配">我为什么需要手动编写模式匹配</h2>
<p>我需要手动编写隐式规则的原因很简单，我现在在<code>windows</code>下使用 Brecht Sanders 的 WinLibs (mingw-winlibs-llvm-ucrt-mcf), 它提供了一个 MinGW-make.exe，但是它的隐式规则有点问题。</p>
<p>例如，当源文件为 <code>.c</code> 时，它默认调用 <code>cc</code>,当然，我可以整个 alias 什么的，但是假如是 <code>.cpp</code> ，他会直接调用错误的路径。</p>
<p>而我平常是习惯，当我在写单文件时直接手动写个 <code>make hello</code>，而不是写更长的编译命令。</p>
<p>而且，make 自带的隐式规则是不支持 latex 的，所以我需要自己编写一个隐式规则来支持 latex。</p>
<h3 id="makefile-的具体内容">makefile 的具体内容</h3>
<blockquote>
<p>! 请不要直接复制这个 makefile，或者至少在复制后确保你得到的 makefile 是采用的 tab 缩进，而不是空格缩进。</p>
<p>这非常重要，因为 makefile 的语法是依赖于 tab 缩进的，如果你使用空格缩进，那么 makefile 就会报错。</p>
</blockquote>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this file is build due to some bugs related to MinGW make</span></span><br><span class="line"><span class="comment"># this is a global makefile for make</span></span><br><span class="line"></span><br><span class="line">CC = gcc</span><br><span class="line">CFLAGS = -Wall -Wextra -pedantic -fexec-charset=GBK -g -O2 -std=c17</span><br><span class="line"><span class="comment"># CFLAGS = -Wall -Werror -Wextra -pedantic -fexec-charset=GBK -g -O2 -std=c17  </span></span><br><span class="line"></span><br><span class="line">CPP = g++</span><br><span class="line">CPPFLAGS = -Wall -Wextra -pedantic -fexec-charset=GBK -g -O2 -std=c++17</span><br><span class="line"><span class="comment"># CPPFLAGS = -Wall -Wextra -Werror -pedantic -fexec-charset=GBK -static-libstdc++ -g -O2 -std=c++17</span></span><br><span class="line"></span><br><span class="line">PDFLATEX = pdflatex</span><br><span class="line"><span class="comment"># e.g. when type make hello, it will build hello.c</span></span><br><span class="line"><span class="comment"># and the output file will be hello</span></span><br><span class="line"></span><br><span class="line">% : %.c</span><br><span class="line"> <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for c++ file</span></span><br><span class="line"></span><br><span class="line">% : %.cpp</span><br><span class="line"> <span class="variable">$(CPP)</span> <span class="variable">$(CPPFLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for latex file</span></span><br><span class="line">% : %.tex</span><br><span class="line"> <span class="variable">$(PDFLATEX)</span> <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>
<h3 id="环境变量-MAKEFILES">环境变量 MAKEFILES</h3>
<p>现在我们有了一个全局的 makefile，但是我们还需要做一些事情，就是将这个 makefile 添加到环境变量中。</p>
<p>添加一个名为 <code>MAKEFILES</code> 的环境变量，它的值就是这个 makefile 的路径。</p>
<blockquote>
<p>! 你必须用这个 <code>MAKEFILES</code> 这个名字，否则 make 是不会读取的。</p>
</blockquote>
<h4 id="The-Variable-MAKEFILES">The Variable MAKEFILES</h4>
<p>如果环境变量 <code>MAKEFILES</code> 被定义了，那么 make 就会将它的值作为一个 makefile 的列表，这个列表中的每一个元素都是一个 makefile 的路径。这一点和 <code>include</code> 指令是一样的，make 会在这些路径中搜索这些 makefile。除此之外，make 也不会从这些 makefile 中读取默认的目标，也不会报错。</p>
<p><code>MAKEFILES</code> 的主要用途是在递归调用 make 时进行通信。通常情况下，不应该在顶层调用 make 之前设置环境变量，因为最好不要从外部干扰 makefile。但是，如果你在没有指定 makefile 的情况下运行 make，那么 <code>MAKEFILES</code> 中的 makefile 可以做一些有用的事情，比如定义搜索路径。</p>
<p>有些用户会在登录时自动在环境中设置 <code>MAKEFILES</code>，并编写 makefile 以期望这样做。这是一个非常糟糕的想法，因为这样的 makefile 在其他用户运行时将无法工作。最好的办法是在 makefile 中编写显式的 include 指令。参见 Including Other Makefiles。</p>
<blockquote>
<p>参加 <a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/MAKEFILES-Variable.html">GNU make manual – The Variable MAKEFILES</a></p>
</blockquote>
<p>这个 makefile 的结构很简单，首先是定义了一些变量，然后是隐式规则。</p>
<h4 id="通配符-wildcard-与自动变量-automatic-variable">通配符 ( wildcard ) 与自动变量 ( automatic variable )</h4>
<p><code>% : %.c</code> 这里的 <code>%</code> 是通配符 ( wildcard )，它可以匹配所有的目标文件。</p>
<p>参见 <a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Pattern-Match.html">GNU make manual – Pattern-Match</a></p>
<p><code>$@</code> 和 <code>$&lt;</code> 是自动变量 ( automatic variable )，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">@</mi><mi mathvariant="normal">‘</mi><mtext>代表了目标文件，</mtext><mi mathvariant="normal">‘</mi></mrow><annotation encoding="application/x-tex">@` 代表了目标文件，`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">@‘</span><span class="mord cjk_fallback">代表了目标文件，</span><span class="mord">‘</span></span></span></span>&lt;` 代表了依赖文件。</p>
<p><code>$@</code> 和 <code>$&lt;</code> 是 makefile 中的特殊符号，你可以在 <a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">GNU make manual – automatic-variables</a> 中查看更多的特殊符号。</p>
<h3 id="全局-makefile-for-latex">全局 makefile for latex</h3>
<p>等等，你是不是还看到了一个奇怪的东西，就是最后的那个 <code>% : %.tex</code>，这是我为了编译 latex 文件而写的，因为我不想每次都写 <code>pdflatex hello.tex hello.pdf</code>。</p>
<p>添加了这个隐式规则之后，我就可以直接使用 <code>make hello</code> 来编译 <code>hello.tex</code> 文件了，是不是很方便。</p>
<p>这也暗示了一种使用方法，你可以根据自己的需求，编写自己的隐式规则，让你的全局 makefile 更加强大。</p>
<p>关于 latex 这里的灵感，是来自于 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/69115581/is-there-a-way-to-define-global-makefile-implicit-rules">Stackoverflow – is-there-a-way-to-define-global-makefile-implicit-rules</a>。</p>
<h2 id="最终效果">最终效果</h2>
<p>其实，这里并不算是隐式规则了，而是我们编写了一个全局的模式规则，这个模式规则可以匹配所有的目标文件。</p>
<p>不过，就效果而言，它和隐式规则是一样的，你可以直接使用 <code>make hello</code> 来编译 <code>hello.c</code> 文件。</p>
<p>同时，这样的好处是，你可以在全局 makefile 中定义一些全局的变量，比如编译器，编译选项等等。</p>
<p>你甚至还可以定义自己的规则，比如编译 latex 文件等。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ make hello</span><br><span class="line">gcc -Wall -Wextra -pedantic -fexec-charset=GBK -g -O2 -std=c17 -o hello hello.c</span><br></pre></td></tr></table></figure>
<p>实际上，这种做法是完全符合官方的遇见的</p>
<blockquote>
<p>You can override a built-in implicit rule (or one you have defined yourself) by defining a new pattern rule with the same target and prerequisites, but a different recipe.</p>
</blockquote>
<p>参见 <a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Canceling-Rules.html">GNU make manual – Canceling-Rules</a></p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">GNU make manual – Automatic-Variables</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/MAKEFILES-Variable.html">GNU make manual – The Variable MAKEFILES</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/69115581/is-there-a-way-to-define-global-makefile-implicit-rules">Stackoverflow – is-there-a-way-to-define-global-makefile-implicit-rules</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Implicit-Rules.html">GNU make manual – Implicit-Rules</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html">GNU make manual – Pattern-Rules</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Pattern-Match.html">GNU make manual – Pattern-Match</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Canceling-Rules.html">GNU make manual – Canceling-Rules</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Jenway">Jenway</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.jenway.link/posts/4a5195d4.html">https://blog.jenway.link/posts/4a5195d4.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/make/">make</a><a class="post-meta__tags" href="/tags/makefile/">makefile</a></div><div class="post-share"><div class="social-share" data-image="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover41.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/cb50296f.html" title="非常特立独行的随机 cover 实现"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover29.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">非常特立独行的随机 cover 实现</div></div><div class="info-2"><div class="info-item-1"> 这篇文章将会介绍一种非常特立独行的 hexo 博客的随机 cover 实现方式。 我们先来看看，网络上流传的一些 hexo 博客的随机 cover 实现方式：  修改主题的配置文件，在默认 cover 的设置里多加几张图 调用网络上的随机图片 API，然后通过主题的默认 cover 来实现 和第二种类似，但是通过自己写个 .php 来实现一个随机图片 API 接口，这种一般需要自己的服务器  这些方法都不太适合我 为什么不适合我 首先，我不想在主题的配置文件里写一堆图片链接，这样太麻烦了，这样看来，随机图片 API 是个不错的选择，但是问题是。 额，我没有服务器啊。 或许你会说，那为什么不用网络上的随机图片 API 呢？  人的 XP 是各不相同的，不一定符合我的审美  更深层次的需求原因 如果是用随机图片 API 的话，那么实际上达到的效果会是，每次刷新播客的首页，都会使得 cover 图片发生变化，虽然这样也是种很不错的效果，但是我对随机封面的需求来源其实和效果倒是没有太大关系： 主要原因是我懒得给每个文章都配一张封面图。 更重要的是，毕竟在国内，所以图床一般用 CDN...</div></div></div></a><a class="pagination-related" href="/posts/b8c13c86.html" title="那时年少春衫薄"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover12.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">那时年少春衫薄</div></div><div class="info-2"><div class="info-item-1"> ​            如今却忆江南乐，当时年少春衫薄。骑马倚斜桥，满楼红袖招。翠屏金屈曲，醉入花丛宿。此度见花枝，白头誓不归——韦庄《菩萨蛮·如今却忆江南乐》   刚才在知乎上看到一个孩子，提问了许多问题，大抵就是11岁学编程先学C 还是 Rust什么的，看样子，是觉得人工智能很火，现在要早早入局，以后卷起一片风云的人物。我也不得不想起，我刚上初中的时候也是这样，对编程很感兴趣，我那个时候是怎样的来着？让我想想。 在我的青春将至的少年时节，我有好多奢望。  虽然囿于小小的天井，不过幸运，或者说无关紧要的是，在我年少的时候我有着一台台式机，连通着互联网。 我因而看到了很多，这些繁杂而又瑰丽的信息让我不由得神往，这些信息勾起了少年的欲望。 那个时候，还是诸如德国下水道，日本夏令营的故事大有受众的时候，我当然也不例外，漫威的电影一部不落，人生目标就是下一个乔帮主或者比尔盖茨，幼小的我想着，以后我也要写出让全世界的人都使用的操作系统，冠以自己的名号，当然，还有上不了台面的——想当世界首富 当然，后来我知道了...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Jenway</div><div class="author-info-description">I love you more than you ever know</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">54</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">49</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Jenway"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Jenway" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:JenwayHere@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=453746313" target="_blank" title="netease"><i class="iconfont icon-netease-cloud-music-fill" style="color: #d51007;"></i></a><a class="social-icon" href="https://space.bilibili.com/179871013" target="_blank" title="bilibili"><i class="fab fa-bilibili" style="color: #00a1d6;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content"><center> =( •̀ ω •́ )= </center></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99-Built-in-Implicit-rules"><span class="toc-number">1.</span> <span class="toc-text">内置隐式规则 (Built-in Implicit rules )</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%A7%84%E5%88%99-Pattern-Rules"><span class="toc-number">1.1.</span> <span class="toc-text">模式规则 ( Pattern Rules )</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E7%BC%96%E5%86%99%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-number">2.</span> <span class="toc-text">我为什么需要手动编写模式匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#makefile-%E7%9A%84%E5%85%B7%E4%BD%93%E5%86%85%E5%AE%B9"><span class="toc-number">2.1.</span> <span class="toc-text">makefile 的具体内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-MAKEFILES"><span class="toc-number">2.2.</span> <span class="toc-text">环境变量 MAKEFILES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Variable-MAKEFILES"><span class="toc-number">2.2.1.</span> <span class="toc-text">The Variable MAKEFILES</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6-wildcard-%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8F%98%E9%87%8F-automatic-variable"><span class="toc-number">2.2.2.</span> <span class="toc-text">通配符 ( wildcard ) 与自动变量 ( automatic variable )</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80-makefile-for-latex"><span class="toc-number">2.3.</span> <span class="toc-text">全局 makefile for latex</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C"><span class="toc-number">3.</span> <span class="toc-text">最终效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">4.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/9e99c60f.html" title="图片与视频编码"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover34.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="图片与视频编码"/></a><div class="content"><a class="title" href="/posts/9e99c60f.html" title="图片与视频编码">图片与视频编码</a><time datetime="2024-10-11T13:27:14.000Z" title="Created 2024-10-11 21:27:14">2024-10-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/46e1063e.html" title="Back to Regression with PyTorch"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover28.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Back to Regression with PyTorch"/></a><div class="content"><a class="title" href="/posts/46e1063e.html" title="Back to Regression with PyTorch">Back to Regression with PyTorch</a><time datetime="2024-09-25T05:46:37.000Z" title="Created 2024-09-25 13:46:37">2024-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5774811a.html" title="我没有去过巴塞罗那，但是 42"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover15.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="我没有去过巴塞罗那，但是 42"/></a><div class="content"><a class="title" href="/posts/5774811a.html" title="我没有去过巴塞罗那，但是 42">我没有去过巴塞罗那，但是 42</a><time datetime="2024-07-15T05:42:11.000Z" title="Created 2024-07-15 13:42:11">2024-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/e585f8d9.html" title="使用 Git-filter-repo 来清理你的 Git Repo 历史"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover26.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Git-filter-repo 来清理你的 Git Repo 历史"/></a><div class="content"><a class="title" href="/posts/e585f8d9.html" title="使用 Git-filter-repo 来清理你的 Git Repo 历史">使用 Git-filter-repo 来清理你的 Git Repo 历史</a><time datetime="2024-06-29T07:10:47.000Z" title="Created 2024-06-29 15:10:47">2024-06-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/baaf2f47.html" title="回归与迭代优化"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://fastly.jsdelivr.net/gh/jenway/J-figure-bed@master/cover/cover18.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="回归与迭代优化"/></a><div class="content"><a class="title" href="/posts/baaf2f47.html" title="回归与迭代优化">回归与迭代优化</a><time datetime="2024-06-26T13:18:40.000Z" title="Created 2024-06-26 21:18:40">2024-06-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By Jenway</div><div class="footer_custom_text"><div style="text-align:center">
  <br />
  <b>I love you more than you ever know.</b>
  <br />
  <br />
  <a target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=for-the-badge&logo=hexo" title="博客框架为Hexo">
  <a target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=for-the-badge&logo=honey" title="博客主题为butterfly">
  <br />
  <a target="_blank" href="https://icp.gov.moe/?keyword=20227445" title="本站已加入萌ICP，萌ICP备20227445号">
  <img style="width:32px;height:32px;margin-bottom:-8px" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://icp.gov.moe/images/ico64.png">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E8%90%8CICP%E5%A4%87-20227445-fe1384?style=for-the-badge">
  <br />
  </a>&nbsp;<a target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=for-the-badge&logo=GitHub" title="Gtihub托管">
  </a>&nbsp;<a target="_blank" href="https://cloudflare.net/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-Cloudflare-orange?style=for-the-badge&logo=Cloudflare" title="CloudFlare提供CDN加速">
  </a>&nbsp;<a target="_blank" href="https://app.netlify.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Netlify-darkcyan?style=for-the-badge&logo=Netlify" title="Netlify托管">
  </a>&nbsp;<a target="_blank" href="https://www.name.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Domain-Name.com-0cedbe?style=for-the-badge&logo=google" title="域名白嫖自 name.com ">
  </a>&nbsp;
  <br />
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  <br />本站已萌萌哒运行 <span id='htmer_time'></span>
</div>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-api-jenway.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo-api-jenway.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.isPost && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU,MORE,THAN,YOU,EVER,KNOW" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script src="/js/dynamicTabTitle.js"></script><script src="/js/runtimeShow.js"></script>
  <!-- require APlayer -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
  <!-- require MetingJS -->
  <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
  <script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
  <meting-js
    server="netease"
    type="playlist"
    order="random"
    id="7290416033"
    fixed=true
    list-folded = "true"
    >
    </meting-js>
  <!-- hexo injector body_end end --></body></html>